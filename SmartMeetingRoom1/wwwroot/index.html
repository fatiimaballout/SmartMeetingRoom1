<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartMeet — Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
    <link href="/css/custom.css" rel="stylesheet" />
</head>
<body>
    <header class="p-3 bg-white border-bottom">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold" href="/index.html">SmartMeet</a>
            <div>
                <span id="navUserName" class="me-3 text-muted">...</span>
                <a id="btnSignOut" class="btn btn-outline-secondary btn-sm" href="#">Sign out</a>
            </div>
        </div>
    </header>

    <main class="container my-4">
        <h1 class="h3">Welcome</h1>
        <p class="text-muted">You are signed in.</p>
        <p><a class="btn btn-primary" href="/admin.html">Go to Admin</a></p>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/auth.js" defer></script>
    <script defer>
        document.addEventListener('DOMContentLoaded', async () => {
            const token = (localStorage.getItem('smr_access_token') || sessionStorage.getItem('smr_access_token') || '');
            if (!token) { location.href = '/login.html'; return; }

            try {
                const meRes = await fetch('/api/auth/me', { headers: { Authorization: 'Bearer ' + token } });
                if (!meRes.ok) { location.href = '/login.html'; return; }
                const me = await meRes.json();
                document.getElementById('navUserName').textContent = me.userName ?? me.UserName ?? me.email ?? 'User';
            } catch {
                location.href = '/login.html';
            }

            document.getElementById('btnSignOut').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('smr_access_token');
                sessionStorage.removeItem('smr_access_token');
                location.href = '/login.html';
            });
        });
    </script>
</body>
</html>
